<script>
    var should_session_check = <%= !current_user.nil? %>;
    (function () {
        var check_every_s = 10;
        var session_time_left = <%= session_time %>;
        var force_sign_in = function () {
            window.location = '/users/sign_in';
        };
        var session_check = function () {
            session_time_left = session_time_left - check_every_s;
            if (should_session_check && session_time_left < 0) {
                $.get('/session_check/time_to_session_expiry')
                        .done(function (d) {
                            if (!d.session_exists) {
                                force_sign_in();
                            }
                        })
                        .fail(force_sign_in);
            }
            setTimeout(session_check, check_every_s * 1000);
        };
        setTimeout(session_check, check_every_s * 1000);
        $.ajaxSetup({
            complete: function (xhr) {
                session_time_left = <%= session_time %>;
            }
        });
    }());
</script>